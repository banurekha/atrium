/* This file is generated by Atrium. You probably don't want to edit
   this file directly, or you'll have to manually merge your changes if later
   versions of Atrium change this file. Instead, use your own JS file
   which over-rides things in this JS file, as described below: Modified on startup */

(function($){
  $(document).ready(function(){
    $('select.chosen').chosen();

    $('.sortable').sortable({
      update: function(e, ui){
        var $target        = $(e.target),
            orderedItems   = {},
            resourceURL    = $target.attr('data-resource'),
            childTag       = $target.children().first()[0].nodeName.toLowerCase(),
            primaryLabel   = $target.attr('data-primary-label'),
            secondaryLabel = $target.attr('data-secondary-label');

        $(childTag, e.target).each(function(index, element){
          var objectId = $(element).attr('data-id');
          orderedItems[objectId] = (index + 1);
        });

        $.ajax({
          type: 'POST',
          url: resourceURL,
          data: {collection: orderedItems},
          success: function(data, statusCode){
            if (childTag == 'li'){
              $target.effect('highlight', {}, 1500);
            } else {
              $target.parents('fieldset').effect('highlight', {}, 1500);
            }

            if (primaryLabel !== undefined){
              $('td.label', $target).text(secondaryLabel);        // This could be implemented better
              $('td.label', $target).first().text(primaryLabel);  //
            }
          }
        });
      }
    });

    $('.colorbox').colorbox({
      width:'880px',
      height:'80%',
      iframe:true,
      onClosed:function(){
        var url = $(this).attr('action');
        $.ajax({
          type: 'GET',
          url: url,
          dataType: 'html',
          cache: true,
          beforeSend: function() {
            $('#cboxLoadedContent').empty();
            $('#cboxLoadingGraphic').show();
          },
          complete: function() {
            $('#cboxLoadingGraphic').hide();
          },
          success: function(data) {
            $('#show_selected').html(data);
            $('#catalog-form').show();
          }
        });
      }
    });

    $('.description').hide();
    $('.add_description').click(function(){
        var $this = $(this);
        $this.parent()
          .children('.description')
          .slideToggle(300, function(){
            if ($this.text() == 'Add Description'){
              $this.text('Hide Description');
            }else{
              $this.text('Add Description');
            }
          });
    });

    $('.customize').click(function(){
        $(this).text($(this).text() == 'Customize this page' ? 'View Exhibit' : 'Customize this page');
        $('browse_page_configure').toggle();
    });

  });
})(jQuery);
