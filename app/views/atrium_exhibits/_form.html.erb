
  <fieldset>
    <legend> General Settings </legend>
<%= form_for(@atrium_exhibit) do |f| %>
  <% if @atrium_exhibit.errors.any? %>
    <ul>
    <% @atrium_exhibit.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  <% end %>

    <table>
      <tr>
	<td>
	  <%= f.label :title, 'Title:' %>
	</td>
	<td>
	  <%= f.text_field :title %>
        </td>
      </tr>
      <tr>
	<td>
          <%= f.label :solr_filter_query, 'Exhibit Scope Query:' %> 
	</td>
	<td>
	  <%= f.text_field :solr_filter_query %>
	</td>
      </tr>
    </table>
  <p>
    <%= f.submit 'Update' %>
  </p>
<% end %>

<fieldset>
  <legend>Browse Sets</legend>

<%=debug @atrium_exhibit.browse_sets.inspect%>
<%= form_for(@atrium_exhibit) do |f| %>
  <%- unless @atrium_exhibit.browse_sets.empty? -%>
    <%- @atrium_exhibit.browse_sets.each do |browse_set|  -%>
      <%= render :partial=>'browse_set_form', :locals=>{:browse_set=>browse_set}%>
    <%- end -%>
  <%- end -%>
<%- end -%>
<%= form_for(@atrium_exhibit) do |f| %>
    <%- @browse_set = Atrium::BrowseSet.new-%>
    <%= f.fields_for :browse_sets, @browse_set do |browse_set_fields| %>
      <%- @browse_set.set_number = @atrium_exhibit.browse_sets.size + 1 -%>
      <%= browse_set_fields.hidden_field :set_number %>
      <%= f.submit 'Add Browse Set' %>
    <% end %>
<% end %>
</fieldset>

<fieldset>
  <legend>Search Facets</legend>
<%= form_for(@atrium_exhibit) do |f| %>
  <%- unless @atrium_exhibit.search_facets.empty? -%>
      <table>
	<tr><th>Search Facet</th><th>Delete</th></tr>
        <%- @atrium_exhibit.search_facets.each do |facet| -%>
        <tr>
          <%= f.fields_for :search_facets, facet do |facet_form| %>
            <td><%=facet_field_labels[facet.name]%></td><td><%=facet_form.check_box :_destroy %></td>
          <% end %>
        </tr>
        <%- end -%>
      </table>
      <p>
	<%= f.submit 'Update' %>
      </p>
    <%- end -%>
<%- end -%>
<%= form_for(@atrium_exhibit) do |f| %>
    <%- @facet = Atrium::Search::Facet.new-%>
    <%= f.fields_for :search_facets, @facet do |facet_fields| %>
      <%- if @atrium_exhibit.search_facets.empty? -%>
        <%- available_facets = facet_field_names -%>
      <%- else -%>
        <%- facet_names = @atrium_exhibit.search_facets.collect {|facet| facet.name}-%>
        <%- available_facets = facet_field_names.reject {|facet| facet_names.include?(facet)} -%>
      <%- end -%>
      <table>
	<tr>
	  <td>
	    <%= facet_fields.select(:name, available_facets.collect {|solr_fname| [facet_field_labels[solr_fname],solr_fname]})%>
	  </td>
	  <td>
	    <%= f.submit 'Add Search Facet' %>
	  </td>
	</tr>
      </table>
    <% end %>
<% end %>
</fieldset>

</fieldset>
